<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head>
    <meta charset="UTF-8" />
    <title>AI Chat â€“ MVC</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="max-w-3xl mx-auto p-6">
    <h1 class="text-2xl font-semibold mb-4">ðŸ§  Demo AI Wissenspeicher (MVC)</h1>
    <!-- RÃ¼ckmeldungen -->
    <div th:if="${uploadSuccess}" class="mb-4 p-3 bg-green-100 text-green-800 rounded-2xl">
        <p th:text="${uploadSuccess}"></p>
    </div>
    <div th:if="${uploadError}" class="mb-4 p-3 bg-red-100 text-red-800 rounded-2xl">
        <p th:text="${uploadError}"></p>
    </div>

    <!-- (Optional) Wissensbasis-Status -->
    <div th:if="${kbTotal != null}" class="mb-6 p-3 bg-white rounded-2xl shadow border">
        <div class="text-sm text-gray-600">
            <span class="font-medium">Wissensbasis:</span>
            <span th:text="${kbTotal}"></span> Eintrag/EintrÃ¤ge gespeichert.
        </div>
    </div>

    <!-- Formular: Chat -->
    <form th:action="@{/ask}" method="post" class="mb-6">
        <th:block th:if="${_csrf != null}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        </th:block>

        <textarea name="prompt" rows="4"
                  class="w-full border rounded-2xl p-3 mb-3"
                  placeholder="Frag mich etwas..."></textarea>

        <button type="submit"
                class="px-4 py-2 bg-indigo-600 text-white rounded-2xl shadow hover:bg-indigo-700">
            Abschicken
        </button>
    </form>

    <!-- Neuer Bereich: Datei-Upload -->
    <div class="mt-8 border-t pt-6">
        <h2 class="text-xl font-semibold mb-4">ðŸ“„ Wissensbasis erweitern (PDF hochladen)</h2>

        <form th:action="@{/ingest/pdf}" method="post" enctype="multipart/form-data" class="flex flex-col gap-3">
            <th:block th:if="${_csrf != null}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            </th:block>

            <input type="file" name="file"
                   accept="application/pdf"
                   class="border rounded-2xl p-3 w-full bg-white"/>

            <button type="submit"
                    class="px-4 py-2 bg-green-600 text-white rounded-2xl shadow hover:bg-green-700">
                Hochladen & in Wissensdatenbank speichern
            </button>
        </form>
    </div>

    <!-- Antwortbereich -->
    <div th:if="${chat}" class="mt-6 bg-white p-4 rounded-2xl shadow">
        <h2 class="font-medium mb-2">Antwort:</h2>
        <p class="text-sm text-gray-500 mb-2" th:text="'Prompt: ' + ${chat.prompt}"></p>
        <p th:text="${chat.answer}"></p>
    </div>
</div>
</body>
</html>
